<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rialo ‚Äî Role Progression Builder</title>
  <style>
    /* -------------------------------------- */
    /* 1. K√ñK RENKLERƒ∞ VE ROL RENKLERƒ∞ */
    /* -------------------------------------- */
    :root{
      --bg:#0f1724; 
      --accent:#7dd3fc;
      --muted:#9ca3af;
      --good:#10b981; 
      --bad:#ef4444;
      /* ROL RENKLERƒ∞ */
      --role-ops: #3b82f6;      /* Blue (OPS) */
      --role-one: #facc15;      /* Yellow (ONE) */
      --role-orbit: #06b6d4;    /* Cyan (ORBIT i√ßin ek renk) */
      --role-club: #f97316;     /* Orange (CLUB MEMBER) */
      --role-loyal: #10b981;    /* Dark Green (RIYALOYAL) */
      --role-og: #ec4899;       /* Pink (OG) */
    }
    
    /* -------------------------------------- */
    /* 2. ANA D√úZEN VE ARKA PLAN */
    /* -------------------------------------- */
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#071023 0%,#06121a 100%);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:980px;max-width:100%;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(2,6,23,0.6);position:relative}
    header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    header img{width:40px;height:40px;object-fit:contain;border-radius:6px;}
    header h1{font-size:18px;margin:0}
    
    /* Ekran ge√ßi≈ü d√ºzeltmesi i√ßin tek tip gizleme */
    .screen, .board-container { display:none; } 
    .screen.show, .board-container.show { display: block; }
    
    .board{display:grid;grid-template-columns:180px 1fr 180px;gap:12px;align-items:center;position:relative}
    .pillar{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:10px;text-align:center}
    .pillar h3{margin:0 0 8px 0;font-size:14px}
    .pillar p{margin:0;color:var(--muted);font-size:13px}
    .middle{height:200px;display:flex;align-items:center;justify-content:flex-start;position:relative}
    .river{position:absolute;left:0;right:0;top:50%;height:24px;background:linear-gradient(90deg,#022c44,#01324c);border-radius:12px;transform:translateY(-50%);box-shadow:inset 0 -6px 12px rgba(0,0,0,0.6)}
    .bridge{position:relative;display:flex;gap:6px;z-index:2}
    .segment{width:64px;height:28px;border-radius:6px;background:#071832;border:2px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--muted);opacity:0.18;transform:translateY(10px);transition:all .36s cubic-bezier(.2,.9,.3,1)}
    
    .segment.active{opacity:1;color:var(--bg);transform:translateY(0);border-color:transparent; transition: all .36s cubic-bezier(.2,.9,.3,1);}
    
    .segment-content{font-size: 8px; text-align: center; line-height: 1; padding: 2px; font-weight: bold;}
    .status{margin-top:12px;display:flex;justify-content:space-between;align-items:center}
    .progress{height:8px;background:#071228;border-radius:999px;overflow:hidden;width:60%}
    
    /* ƒ∞lerleme √ßubuƒüunun (i#prog) stil tanƒ±mƒ± */
    .progress > i{display:block;height:100%;width:0%;transition:width .5s ease; background: var(--accent);}
    
    .controls{display:flex;gap:8px;align-items:center}
    button.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:#dbeafe;cursor:pointer;transition:background 0.2s}
    button.btn:hover{background:rgba(255,255,255,0.05);}
    button.btn-primary{background:var(--accent); color:var(--bg); border-color:var(--accent);}
    button.btn-primary:hover{background:#93c5fd;}
    .card{margin-top:14px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.005));padding:16px;border-radius:10px}
    .q{font-size:15px;margin:0 0 12px 0}
    .answers{display:flex;flex-direction:column;gap:8px}
    .answer{background:#061422;border:1px solid rgba(255,255,255,0.02);padding:10px;border-radius:8px;cursor:pointer;transition:all .2s ease}
    .answer:hover{transform:translateY(-3px)}
    .answer.correct{border-color:rgba(16,185,129,0.3);box-shadow:0 6px 18px rgba(16,185,129,0.06)}
    .answer.wrong{opacity:0.5;border-color:rgba(239, 68, 68, 0.3);box-shadow:0 6px 18px rgba(239, 68, 68, 0.06);}
    .small{font-size:13px;color:var(--muted)}
    
    .win{background:linear-gradient(90deg,var(--role-og),#321c08);}
    .lose{background:linear-gradient(90deg,#300808,#321c08);}
    .start-screen{max-width: 400px; margin: 50px auto; padding: 30px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02); border-radius: 12px;}
    .start-screen input{width: 100%; padding: 10px; margin: 10px 0 20px 0; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #fff; border-radius: 6px;}
    .character{position:absolute;bottom:50px;width:64px;height:64px;transition:all .5s ease;pointer-events:none;z-index:3}
    
    .leaderboard-list{list-style: none; padding: 0; margin: 20px 0; max-height: 400px; overflow-y: auto;}
    .leaderboard-list li{display: flex; justify-content: space-between; padding: 8px 15px; margin-bottom: 5px; border-radius: 6px; background: rgba(255,255,255,0.03); font-size: 15px;}
    .leaderboard-list li:first-child{background: var(--good); color: var(--bg); font-weight: bold;}
    .leaderboard-list li:nth-child(2){background: #9ca3af; color: var(--bg);}
    .leaderboard-list li:nth-child(3){background: #78350f; color: #fff;}

    /* -------------------------------------- */
    /* 3. YARATICI Lƒ∞NKƒ∞ (FOOTER) */
    /* -------------------------------------- */
    .creator-link{
        text-align: right;
        font-size: 11px;
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid rgba(255,255,255,0.03); /* Hafif bir √ßizgi ekler */
        color: var(--muted);
    }
    /* Sadece start ve leaderboard ekranlarƒ±nda altbilginin d√ºzg√ºn g√∂r√ºnmesi i√ßin hizalamayƒ± d√ºzeltiriz. */
    #startScreen .creator-link, #leaderboardBox .creator-link {
        text-align: center; 
        border-top: 1px solid rgba(255,255,255,0.1); 
        margin-top: 30px; 
    }
    
    .creator-link a{
        color: var(--accent);
        text-decoration: none;
        font-weight: bold;
        transition: color 0.2s;
    }
    .creator-link a:hover{
        color: #fff;
        text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <img src="https://i.ibb.co/0jTwk6tM/logo.png" alt="Rialo Logo">
      <div>
        <h1>Rialo ‚Äî Role Progression Builder</h1>
        <div class="small">Answer questions to advance through the Rialo Community Roles.</div>
      </div>
    </header>

    <div class="screen start-screen show" id="startScreen">
        <h3>Welcome, Builder!</h3>
        <p class="small">Enter your name to begin building your role path.</p>
        <input type="text" id="userNameInput" placeholder="Enter your name" maxlength="20">
        <button class="btn btn-primary" id="startBtn">Start Game</button>
        <button class="btn" id="viewLeaderboardBtn">View Global Leaderboard</button>
        <div class="creator-link">
            Game Creator: <a href="https://x.com/burakkuru5534" target="_blank">@burakkuru5534</a>
        </div>
    </div>

    <div class="screen" id="leaderboardBox">
        <h3>Top Role Achievers üèÜ</h3>
        <p class="small" id="leaderboardStatus">Loading scores from server...</p>
        <ul id="leaderboardList" class="leaderboard-list"></ul>
        <button class="btn" id="backToStartBtn">Back to Start</button>
        <div class="creator-link">
            Game Creator: <a href="https://x.com/burakkuru5534" target="_blank">@burakkuru5534</a>
        </div>
    </div>

    <div class="board-container" id="gameScreen">
        <div class="info-bar">
            <div class="score-box">Score: <strong id="scoreText">0</strong></div>
            <div class="attempts-box">Wrong Attempts Left: <strong id="attemptsText">3</strong></div>
        </div>

        <div class="board">
            <aside class="pillar" aria-hidden="true">
                <h3>Newcomer</h3>
                <p>Starting the Rialo Journey.</p>
            </aside>

            <section class="middle" aria-live="polite">
                <div class="bridge" id="bridge"></div>
                <div class="river" aria-hidden="true"></div>
                <img src="https://i.ibb.co/MyYfrWp2/character.png" class="character" id="character" alt="Role Builder">
            </section>

            <aside class="pillar" aria-hidden="true">
                <h3>RialOG</h3>
                <p>Final Community Rank.</p>
            </aside>
        </div>

        <div class="status">
            <div class="progress" aria-hidden="true"><i id="prog"></i></div>
            <div class="controls">
                <div class="small" id="progressText">0/20 segments</div>
                <button class="btn" id="resetBtn">Restart Game</button>
            </div>
        </div>
        
        <div class="creator-link">
            Game Creator: <a href="https://x.com/burakkuru5534" target="_blank">@burakkuru5534</a>
        </div>

        <div class="card" id="questionCard">
            <p class="q" id="questionText">Loading question...</p>
            <div class="answers" id="answers"></div>
        </div>
    </div>

    <div class="screen win" id="winBox">
        <h3>RialOG Achieved! üëë</h3>
        <p class="small">You successfully built the entire bridge and earned the **RialOG** status! Your Final Score is: <strong id="finalWinScore">0</strong></p>
        <div style="margin-top:12px"><button class="btn btn-primary" id="playAgainWin">Play again</button></div>
        <div style="margin-top:12px"><button class="btn" id="leaderboardBtnWin">View Global Leaderboard</button></div>
        <div class="creator-link">
            Game Creator: <a href="https://x.com/burakkuru5534" target="_blank">@burakkuru5534</a>
        </div>
    </div>

    <div class="screen lose" id="loseBox">
        <h3>Journey Halted ‚ùå</h3>
        <p class="small">You ran out of attempts and couldn't complete the path. Your Final Score is: <strong id="finalLoseScore">0</strong></p>
        <div style="margin-top:12px"><button class="btn btn-primary" id="playAgainLose">Try again</button></div>
        <div style="margin-top:12px"><button class="btn" id="leaderboardBtnLose">View Global Leaderboard</button></div>
        <div class="creator-link">
            Game Creator: <a href="https://x.com/burakkuru5534" target="_blank">@burakkuru5534</a>
        </div>
    </div>
  </div>

  <script>
    // --- √ñNEMLƒ∞: API Yapƒ±landƒ±rmasƒ± (SheetDB URL) ---
    const LEADERBOARD_API_URL = 'https://sheetdb.io/api/v1/4k80wda9socqk'; 

    const MAX_SEGMENTS = 20; 
    const MAX_WRONG_ATTEMPTS = 3;
    const POINTS_CORRECT = 100;
    const POINTS_PENALTY = 50;
    
    // --- Game State Variables ---
    let currentSegment = 0;
    let wrongAttempts = 0;
    let score = 0;
    let userName = '';
    
    // YENƒ∞: Oyun i√ßin karƒ±≈ütƒ±rƒ±lmƒ±≈ü soru dizisi
    let gameQuestions = [];
    
    // --- Thematic Bridge Segment Concepts (ROL ƒ∞Sƒ∞MLERƒ∞) ---
    const BRIDGE_SEGMENT_CONCEPTS = [
        "RialOPS L1 / Raid Beginner", "RialOPS L2 / Contributor", "RialOPS L3 / Raid Master",
        "RialONE L1 / Onboarded", "RialONE L2 / Task Completer", "RialONE L3 / Community Ready",
        "RialORBIT L1 / Creator Tier", "RialORBIT L2 / HQ Content", "RialORBIT L3 / 10K Views", "RialORBIT L4 / Orbit Stabilized",
        "Rialo Club L1 / Member Ready", "Rialo Club L2 / Weekly Select", "Rialo Club L3 / Best Creator", "Rialo Club L4 / Club Legend",
        "RialOYAL L1 / Active Member", "RialOYAL L2 / Engagement", "RialOYAL L3 / Weekly VIP", "RialOYAL L4 / Loyalty Tier", "RialOYAL L5 / Loyalty Master",
        "RialOG / FINAL RANK"
    ];

    // --- Game Elements ---
    const startScreen = document.getElementById('startScreen');
    const gameScreen = document.getElementById('gameScreen');
    const leaderboardBox = document.getElementById('leaderboardBox');
    const userNameInput = document.getElementById('userNameInput');
    const leaderboardList = document.getElementById('leaderboardList');
    const leaderboardStatus = document.getElementById('leaderboardStatus');
    
    const bridgeEl = document.getElementById('bridge');
    const characterEl = document.getElementById('character');
    const progEl = document.getElementById('prog'); 
    const progressTextEl = document.getElementById('progressText');
    const questionCardEl = document.getElementById('questionCard');
    const scoreTextEl = document.getElementById('scoreText');
    const attemptsTextEl = document.getElementById('attemptsText');
    const questionTextEl = document.getElementById('questionText');
    const answersEl = document.getElementById('answers');
    const winBoxEl = document.getElementById('winBox');
    const loseBoxEl = document.getElementById('loseBox');
    const finalWinScoreEl = document.getElementById('finalWinScore');
    const finalLoseScoreEl = document.getElementById('finalLoseScore');

    // --- The Quiz Data (20 Questions - Unchanged) ---
    const questions = [
        { q: "1. What is Rialo primarily designed for?", a: [{ text: "Social networking", isCorrect: false }, { text: "Real-world app development", isCorrect: true }, { text: "Cryptocurrency trading", isCorrect: false }, { text: "Gaming", isCorrect: false }] },
        { q: "2. Which company developed Rialo?", a: [{ text: "Subzero Labs", isCorrect: true }, { text: "Meta", isCorrect: false }, { text: "Google", isCorrect: false }, { text: "Amazon", isCorrect: false }] },
        { q: "3. What is a unique feature of Rialo's architecture?", a: [{ text: "Centralized data storage", isCorrect: false }, { text: "Native internet connectivity for apps", isCorrect: true }, { text: "Limited cross-chain functionality", isCorrect: false }, { text: "No support for real-world data", isCorrect: false }] },
        { q: "4. How does Rialo handle real-world data?", a: [{ text: "Through middleware", isCorrect: false }, { text: "Using trust-minimized on-chain feeds", isCorrect: true }, { text: "By relying on external APIs", isCorrect: false }, { text: "Through centralized databases", isCorrect: false }] },
        { q: "5. What is Rialo's approach to application deployment?", a: [{ text: "Requires complex setup", isCorrect: false }, { text: "Apps launch with minimal configuration", isCorrect: true }, { text: "Limited to specific platforms", isCorrect: false }, { text: "Requires third-party plugins", isCorrect: false }] },
        { q: "6. Which of the following is a key feature of Rialo's communication system?", a: [{ text: "Unencrypted messages", isCorrect: false }, { text: "Encrypted communication via email, phone, or device ID", isCorrect: true }, { text: "No support for direct messaging", isCorrect: false }, { text: "Only supports wallet-based communication", isCorrect: false }] },
        { q: "7. What type of applications is Rialo optimized for?", a: [{ text: "Decentralized applications with real-world capabilities", isCorrect: true }, { text: "Centralized enterprise software", isCorrect: false }, { text: "Mobile gaming applications", isCorrect: false }, { text: "Social media platforms", isCorrect: false }] },
        { q: "8. What is Rialo's stance on middleware?", a: [{ text: "Embraces complex middleware solutions", isCorrect: false }, { text: "Eliminates the need for middleware", isCorrect: true }, { text: "Supports only specific middleware", isCorrect: false }, { text: "Requires middleware for all applications", isCorrect: false }] },
        { q: "9. How does Rialo ensure real-time application responsiveness?", a: [{ text: "By using delayed data processing", isCorrect: false }, { text: "Through native real-world data integration", isCorrect: true }, { text: "By relying on periodic updates", isCorrect: false }, { text: "Through manual data entry", isCorrect: false }] },
        { q: "10. What is Rialo's approach to privacy?", a: [{ text: "No encryption methods", isCorrect: false }, { text: "Provides secure-by-default communication", isCorrect: true }, { text: "Relies on third-party security services", isCorrect: false }, { text: "Offers limited privacy features", isCorrect: false }] },
        { q: "11. Which of the following is NOT a feature of Rialo?", a: [{ text: "Real-world data integration", isCorrect: false }, { text: "Native internet connectivity for apps", isCorrect: false }, { text: "Centralized data storage", isCorrect: true }, { text: "Encrypted communication", isCorrect: false }] },
        { q: "12. How does Rialo handle cross-chain data movement?", a: [{ text: "Through bridges and wrappers", isCorrect: false }, { text: "By using native cross-chain functionality", isCorrect: true }, { text: "Requires manual intervention", isCorrect: false }, { text: "Not supported", isCorrect: false }] },
        { q: "13. What is Rialo's approach to application logic?", a: [{ text: "Requires external processing", isCorrect: false }, { text: "Logic runs natively within the platform", isCorrect: true }, { text: "Limited to predefined templates", isCorrect: false }, { text: "Must be coded externally", isCorrect: false }] },
        { q: "14. How does Rialo support real-world asset management?", a: [{ text: "Through centralized platforms", isCorrect: false }, { text: "By integrating real-world data on-chain", isCorrect: true }, { text: "By relying on external databases", isCorrect: false }, { text: "Not supported", isCorrect: false }] },
        { q: "15. What is Rialo's approach to application scalability?", a: [{ text: "Limited scalability options", isCorrect: false }, { text: "Scalable through native architecture", isCorrect: true }, { text: "Requires third-party solutions", isCorrect: false }, { text: "Not supported", isCorrect: false }] },
        { q: "16. How does Rialo handle application updates?", a: [{ text: "Manual updates required", isCorrect: false }, { text: "Automatic updates through native system", isCorrect: true }, { text: "Updates through external services", isCorrect: false }, { text: "Not supported", isCorrect: false }] },
        { q: "17. What is Rialo's approach to application security?", a: [{ text: "No security measures", isCorrect: false }, { text: "Provides secure-by-default features", isCorrect: true }, { text: "Relies on third-party security tools", isCorrect: false }, { text: "Limited security features", isCorrect: false }] },
        { q: "18. How does Rialo handle user authentication?", a: [{ text: "Through external services", isCorrect: false }, { text: "Native authentication mechanisms", isCorrect: true }, { text: "Manual authentication processes", isCorrect: false }, { text: "Not supported", isCorrect: false }] },
        { q: "19. What is Rialo's approach to application deployment speed?", a: [{ text: "Slow deployment processes", isCorrect: false }, { text: "Fast deployment through native tools", isCorrect: true }, { text: "Requires extensive configuration", isCorrect: false }, { text: "Not supported", isCorrect: false }] },
        { q: "20. How does Rialo handle application maintenance?", a: [{ text: "Manual maintenance required", isCorrect: false }, { text: "Automated maintenance through native system", isCorrect: true }, { text: "Requires third-party services", isCorrect: false }, { text: "Not supported", isCorrect: false }] }
    ];

    // --- Screen Control Functions ---
    function showScreen(screenId) {
        document.querySelectorAll('.screen, .board-container').forEach(el => el.classList.remove('show'));
        document.getElementById(screenId).classList.add('show');
    }

    // --- KARMA FONKSƒ∞YONU ---
    /**
     * Diziyi Fisher-Yates algoritmasƒ±yla karƒ±≈ütƒ±rƒ±r.
     * @param {Array} array - Karƒ±≈ütƒ±rƒ±lacak dizi.
     */
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; // Swap
        }
    }

    // --- Ba≈ülangƒ±√ß Fonksiyonu ---
    function initGame() {
        const name = userNameInput.value.trim();
        if (name.length < 2) {
            alert("Please enter a name to begin!");
            return;
        }
        
        userName = name;
        resetGame();
        showScreen('gameScreen');
    }

    // --- Helper Functions for Role Colors ---
    function getRoleColor(segmentIndex) {
        if (segmentIndex < 3) return 'var(--role-ops)';      
        if (segmentIndex < 6) return 'var(--role-one)';      
        if (segmentIndex < 10) return 'var(--role-orbit)';   
        if (segmentIndex < 14) return 'var(--role-club)';    
        if (segmentIndex < 19) return 'var(--role-loyal)';   
        if (segmentIndex === 19) return 'var(--role-og)';    
        return 'var(--accent)'; 
    }

    // --- G√∂rsel Segment ƒ∞√ßeriƒüi ve Renklerini G√ºncelleme ---
    function updateBridgeVisuals() {
        const completedSegmentIndex = currentSegment > 0 ? currentSegment - 1 : 0;
        const visualSegmentOffset = Math.floor(completedSegmentIndex / 6) * 6;
        const displaySegments = 6;
        
        for (let i = 0; i < displaySegments; i++) {
            const segmentEl = document.getElementById(`segment-${i}`);
            const segmentActualIndex = visualSegmentOffset + i;
            
            if (!segmentEl) continue;

            if (segmentActualIndex < MAX_SEGMENTS) {
                const conceptText = BRIDGE_SEGMENT_CONCEPTS[segmentActualIndex];
                segmentEl.innerHTML = `<span class='segment-content'>${conceptText.replace(' / ', '<br/>')}</span>`;
                segmentEl.style.display = 'flex'; 
            } else {
                segmentEl.style.display = 'none'; 
            }
            
            if (segmentActualIndex < currentSegment) {
                const segmentColor = getRoleColor(segmentActualIndex);
                segmentEl.classList.add('active');
                segmentEl.style.backgroundColor = segmentColor;
                segmentEl.style.color = 'var(--bg)';
            } else {
                segmentEl.classList.remove('active');
                segmentEl.style.backgroundColor = '#071832';
                segmentEl.style.color = 'var(--muted)';
            }
        }

        const color = getRoleColor(completedSegmentIndex);
        if (currentSegment > 0) {
            progEl.style.backgroundColor = color; 
        } else {
            progEl.style.backgroundColor = 'var(--accent)';
        }
    }


    // --- Leaderboard Functions ---
    async function fetchScores(limit = 0) {
        let apiUrl = LEADERBOARD_API_URL;
        
        if (limit > 0) {
            apiUrl += `?sort_by=score&sort_order=desc&limit=${limit}`;
        }
        
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) {
                throw new Error(`API returned status ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error("Error fetching leaderboard:", error);
            return [];
        }
    }

    async function saveScore(name, score) {
        // 1. Kullanƒ±cƒ±nƒ±n mevcut en y√ºksek skorunu bulmak i√ßin t√ºm listeyi √ßek
        const existingScores = await fetchScores(0); 
        
        let highestExistingScore = 0;
        existingScores.forEach(entry => {
            if (entry.name && entry.name.toLowerCase() === name.toLowerCase()) {
                const currentScore = parseInt(entry.score);
                if (!isNaN(currentScore) && currentScore > highestExistingScore) {
                    highestExistingScore = currentScore;
                }
            }
        });

        // 2. Yeni skor mevcut en y√ºksek skordan d√º≈ü√ºk veya e≈üitse kaydetme
        if (score <= highestExistingScore) {
            console.log(`Score not submitted. New score (${score}) is not higher than best score (${highestExistingScore}).`);
            return;
        }

        // 3. Yeni skor daha y√ºksekse: √ñnce eski kayƒ±tlarƒ± sil, sonra yenisini ekle.

        // A. Eski kayƒ±tlarƒ± sil 
        try {
            const deleteUrl = `${LEADERBOARD_API_URL}/name/${encodeURIComponent(name)}`; 
            await fetch(deleteUrl, { method: 'DELETE' });
            console.log(`Successfully deleted previous records for ${name}.`);
        } catch (error) {
            console.error("Error during deletion:", error);
        }
        
        // B. Yeni y√ºksek skoru kaydet
        try {
            const response = await fetch(LEADERBOARD_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    data: {
                        name: name,
                        score: score,
                        date: new Date().toLocaleDateString('en-US'), 
                    }
                }),
            });
            if (!response.ok) {
                const errorData = await response.json();
                console.error("Failed to submit score:", errorData);
                throw new Error(`Failed to submit score, status: ${response.status}`);
            }
            console.log("New high score submitted successfully.");
        } catch (error) {
            console.error("Error submitting score:", error);
        }
    }

    async function displayLeaderboard() {
        leaderboardList.innerHTML = '';
        showScreen('leaderboardBox');
        
        leaderboardStatus.textContent = "Loading scores from server...";
        const leaderboard = await fetchScores(20); 

        if (leaderboard.length === 0) {
            leaderboardList.innerHTML = '<li>No scores yet. Play to set a record!</li>';
            leaderboardStatus.textContent = "No scores found.";
            return;
        }
        leaderboardStatus.textContent = "Scores loaded successfully.";
        
        leaderboard.forEach((item, index) => {
            const li = document.createElement('li');
            const scoreValue = parseInt(item.score);
            if (!isNaN(scoreValue)) {
                li.innerHTML = `<span>#${index + 1}. ${item.name}</span><span>${scoreValue} pts (${item.date || 'N/A'})</span>`;
                leaderboardList.appendChild(li);
            }
        });
    }

    /**
     * Cevap ≈üƒ±klarƒ±nƒ± karƒ±≈ütƒ±rƒ±r ve DOM'a ekler.
     * @param {Object} qData - Soru verisi.
     */
    function resetAnswers(qData) {
        answersEl.innerHTML = ''; 
        
        // YENƒ∞: Cevap ≈üƒ±klarƒ±nƒ± karƒ±≈ütƒ±r.
        shuffleArray(qData.a); 
        
        qData.a.forEach((answer) => {
            const answerEl = document.createElement('div');
            answerEl.className = 'answer';
            answerEl.textContent = answer.text;
            answerEl.onclick = () => handleAnswerClick(answer, answerEl);
            answersEl.appendChild(answerEl);
        });
    }

    // --- Game Logic Functions ---
    function setupBridge() {
        bridgeEl.innerHTML = '';
        const segmentWidth = 64; 
        const segmentGap = 6; 
        const displaySegments = 6;
        const bridgeTotalWidth = (displaySegments * segmentWidth) + ((displaySegments - 1) * segmentGap); 

        bridgeEl.style.width = `${bridgeTotalWidth}px`; 

        for (let i = 0; i < displaySegments; i++) {
            const segment = document.createElement('div');
            segment.className = 'segment';
            segment.id = `segment-${i}`; 
            segment.innerHTML = `<span class='segment-content'>LOADING...</span>`; 
            bridgeEl.appendChild(segment);
        }
    }

    function updateUI() {
        scoreTextEl.textContent = score;
        attemptsTextEl.textContent = MAX_WRONG_ATTEMPTS - wrongAttempts;

        if (wrongAttempts >= MAX_WRONG_ATTEMPTS) {
            endGame(false); 
            return;
        }
        if (currentSegment === MAX_SEGMENTS) {
            endGame(true); 
            return;
        }

        const progressPercent = (currentSegment / MAX_SEGMENTS) * 100;
        progEl.style.width = `${progressPercent}%`;
        progressTextEl.textContent = `${currentSegment}/${MAX_SEGMENTS} segments`;
        
        const visualSegment = currentSegment % 6; 
        const segmentWidth = 64;
        const segmentGap = 6;
        let charLeft;

        // Karakterin pozisyonunu hesapla
        if (currentSegment === 0) {
            charLeft = -32; 
        } else {
            const segmentsBuilt = visualSegment;
            charLeft = (segmentsBuilt * segmentWidth) + ((segmentsBuilt - 1) * segmentGap) - (segmentWidth / 2) - (characterEl.offsetWidth / 2);
            if (segmentsBuilt === 0) {
                 charLeft = segmentWidth - (segmentWidth / 2) - (characterEl.offsetWidth / 2);
            }
        }
        
        characterEl.style.left = `calc(50% - ${bridgeEl.offsetWidth / 2 - charLeft}px)`;

        updateBridgeVisuals(); 
        
        if (currentSegment < MAX_SEGMENTS) {
            loadQuestion(gameQuestions[currentSegment]);
        }
    }

    function loadQuestion(qData) {
        questionCardEl.style.display = 'block'; 
        questionTextEl.textContent = qData.q;
        resetAnswers(qData);
    }

    function handleAnswerClick(answer, element) {
        // T√ºm cevaplarƒ±n tƒ±klama olaylarƒ±nƒ± engelle
        answersEl.querySelectorAll('.answer').forEach(el => el.onclick = null);

        if (answer.isCorrect) {
            element.classList.add('correct');
            score += POINTS_CORRECT;
            
            setTimeout(() => {
                currentSegment++; // Bir sonraki segmente ge√ß
                updateUI();
            }, 600);

        } else {
            // YANLI≈û CEVAP
            element.classList.add('wrong');
            score = Math.max(0, score - POINTS_PENALTY); 
            wrongAttempts++;

            // YENƒ∞: Doƒüru cevabƒ± ye≈üil ile g√∂sterme mantƒ±ƒüƒ± kaldƒ±rƒ±ldƒ±.
            // Sadece yanlƒ±≈ü cevap kƒ±rmƒ±zƒ± ile i≈üaretlenir.
            
            // SORU DEƒûƒ∞≈ûƒ∞M MANTIƒûI:
            
            // Kalan sorularƒ±n olduƒüu havuzun ba≈ülangƒ±cƒ±: currentSegment + 1
            const remainingQuestionCount = MAX_SEGMENTS - (currentSegment + 1);

            if (remainingQuestionCount > 0) {
                // Kalan sorulardan rastgele birini se√ß
                const startIndex = currentSegment + 1;
                const randomIndexOffset = Math.floor(Math.random() * remainingQuestionCount);
                const randomIndexToSwap = startIndex + randomIndexOffset;

                // Mevcut yanlƒ±≈ü cevaplanan soruyu (currentSegment) o rastgele soruyla deƒüi≈ütir (Swap)
                const currentQ = gameQuestions[currentSegment];
                gameQuestions[currentSegment] = gameQuestions[randomIndexToSwap];
                gameQuestions[randomIndexToSwap] = currentQ;

                console.log(`Wrong answer. Swapped question at index ${currentSegment} with question at index ${randomIndexToSwap}.`);
            } else {
                 console.log("Wrong answer. No more unasked questions left to swap.");
            }
            
            setTimeout(() => {
                // Yeni rastgele soruyu y√ºkle (currentSegment aynƒ± kalƒ±r)
                updateUI();
            }, 1500);
        }
    }

    function endGame(isWin) {
        saveScore(userName, score);
        questionCardEl.style.display = 'none';
        
        if (isWin) {
            finalWinScoreEl.textContent = score;
            showScreen('winBox');
        } else {
            finalLoseScoreEl.textContent = score;
            showScreen('loseBox');
        }
    }

    function resetGame() {
        currentSegment = 0;
        wrongAttempts = 0;
        score = 0;
        
        // Sorularƒ± karƒ±≈ütƒ±r ve oyuna hazƒ±rla
        gameQuestions = [...questions]; 
        shuffleArray(gameQuestions);
        
        document.getElementById('winBox').classList.remove('show');
        document.getElementById('loseBox').classList.remove('show');

        setupBridge(); 
        updateUI(); 
    }

    // --- Event Listeners ---
    document.getElementById('startBtn').addEventListener('click', initGame);
    document.getElementById('viewLeaderboardBtn').addEventListener('click', displayLeaderboard);
    document.getElementById('backToStartBtn').addEventListener('click', () => showScreen('startScreen'));
    
    document.getElementById('playAgainWin').addEventListener('click', initGame);
    document.getElementById('playAgainLose').addEventListener('click', initGame);
    document.getElementById('resetBtn').addEventListener('click', initGame);

    document.getElementById('leaderboardBtnWin').addEventListener('click', displayLeaderboard);
    document.getElementById('leaderboardBtnLose').addEventListener('click', displayLeaderboard);

    // Initial load
    showScreen('startScreen');

  </script>
</body>
</html>
